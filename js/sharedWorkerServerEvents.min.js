(()=>{"use strict";class e extends EventTarget{mode="production";eventsUrl=null;constructor(e,n=""){super(),null!==n&&(this.mode=n),this.eventsUrl=e}init(){}onEventTriggered(e){"production"!==this.mode&&console.log("ServerEventsDriver: Server triggered event",e);const n=new CustomEvent("event",{detail:e,data:{bar:"baz"}});this.dispatchEvent(n)}}class n extends e{#e=null;init(){null===this.#e&&("production"!==this.mode&&console.log("init ServerEventsSSEDriver. ",this.eventsUrl),this.#e=new EventSource(this.eventsUrl),"production"!==this.mode&&(this.#e.onopen=function(e){console.log("ServerEventsSSEDriver connection is open")}),this.#e.onmessage=e=>{const n=JSON.parse(e.data);void 0!==n.data&&"string"==typeof n.data&&""!==n.data&&(n.data=JSON.parse(n.data)),n.eventId=e.lastEventId,this.onEventTriggered(n)},"production"!==this.mode&&(this.#e.onerror=function(e){console.log("ServerEventsSSEDriver connection error")}))}}class t extends e{}class o{#n="/";#t="production";constructor(e=null,n=null){null!==e&&(this.#n=e),null!==n&&(this.#t=n)}getByType(e){let o=null;const r=this.#n+"?n=server-events&a=sse",s=this.#n+"?n=server-events&a=ajax";return"serverSentEvents"===e?(o=new n(r),"production"!==this.#t&&console.log("using ServerEventsSSEDriver",r)):(o=new t(s),"production"!==this.#t&&console.log("using ServerEventsAjaxDriver",s)),o}}class r{#o=null;mode="production";driverType=null;baseUrl="/";onEvent=null;init(){if(null!==this.#o)return;"production"!==this.mode&&console.log("init server events Shared worker");const e=new o(this.baseUrl,this.mode);this.#o=e.getByType(this.driverType),this.#o.addEventListener("event",(e=>{"function"!=typeof this.onEvent&&console.error(this.constructor.name+".onEvent is not defined"),this.onEvent(e.detail)})),this.#o.init()}}const s=[];let i=null;self.onconnect=e=>{const n=e.ports[0];s.push(n),null===i&&(i=new r,i.onEvent=e=>{"production"!==i.mode&&console.log("Shared worker postMessage",e);for(const n of s)n.postMessage(e)}),n.onmessage=e=>{const n=e.data;void 0!==n.config&&(null===i.driverType&&(i.driverType=n.config.driver),i.mode=n.config.mode,i.baseUrl=n.config.baseUrl,i.init()),"production"!==i.mode&&console.log("Shared worker message",n)}}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aEIrQixFQUFPekMsTUFDUFEsUUFBUUMsSUFBSSw0QkFBNkJDLEdBRzdDLElBQUssTUFBTW9DLEtBQVVOLEVBQ2pCTSxFQUFPQyxZQUFZckMsRUFDdkIsR0FJUmtDLEVBQUt6QixVQUFhNkIsSUFDZCxNQUFNQyxFQUFVRCxFQUFFbkMsVUFFS1MsSUFBbkIyQixFQUFRQyxTQUNrQixPQUF0QlQsRUFBT1gsYUFDUFcsRUFBT1gsV0FBYW1CLEVBQVFDLE9BQU9uQixRQUV2Q1UsRUFBT3pDLEtBQU9pRCxFQUFRQyxPQUFPbEQsS0FDN0J5QyxFQUFPYixRQUFVcUIsRUFBUUMsT0FBT3RCLFFBQ2hDYSxFQUFPcEMsUUFHUyxlQUFoQm9DLEVBQU96QyxNQUNQUSxRQUFRQyxJQUFJLHdCQUF5QndDLEVBQ3pDLENBQ0osQyIsInNvdXJjZXMiOlsid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL2RyaXZlci9CYXNlU2VydmVyRXZlbnRzRHJpdmVyLmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL2RyaXZlci9TZXJ2ZXJFdmVudHNTU0VEcml2ZXIuanMiLCJ3ZWJwYWNrOi8vY290b250aS8uL3NyYy9zZXJ2ZXJFdmVudHMvZHJpdmVyL1NlcnZlckV2ZW50c0FqYXhEcml2ZXIuanMiLCJ3ZWJwYWNrOi8vY290b250aS8uL3NyYy9zZXJ2ZXJFdmVudHMvZHJpdmVyL1NlcnZlckV2ZW50c0RyaXZlckZhY3RvcnkuanMiLCJ3ZWJwYWNrOi8vY290b250aS8uL3NyYy9zZXJ2ZXJFdmVudHMvc2hhcmVkV29ya2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7U2VydmVyRXZlbnRzU1NFRHJpdmVyfSBmcm9tIFwiLi9TZXJ2ZXJFdmVudHNTU0VEcml2ZXJcIjtcclxuLy8gaW1wb3J0IHtTZXJ2ZXJFdmVudHNBamF4RHJpdmVyfSBmcm9tIFwiLi9TZXJ2ZXJFdmVudHNBamF4RHJpdmVyXCI7XHJcblxyXG4vKipcclxuICogQmFzZSBzZXJ2ZXIgZXZlbnRzIGRyaXZlclxyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEJhc2VTZXJ2ZXJFdmVudHNEcml2ZXIgZXh0ZW5kcyBFdmVudFRhcmdldCB7XHJcbiAgICBtb2RlID0gJ3Byb2R1Y3Rpb24nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge3N0cmluZ3xudWxsfVxyXG4gICAgICovXHJcbiAgICBldmVudHNVcmwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGV2ZW50c1VybCwgbW9kZSA9ICcnKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgaWYgKG1vZGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ldmVudHNVcmwgPSBldmVudHNVcmw7XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdCgpIHsgfVxyXG5cclxuICAgIG9uRXZlbnRUcmlnZ2VyZWQoZXZlbnREYXRhKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZXJ2ZXJFdmVudHNEcml2ZXI6IFNlcnZlciB0cmlnZ2VyZWQgZXZlbnQnLCBldmVudERhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2V2ZW50Jywge1xyXG4gICAgICAgICAgICBkZXRhaWw6IGV2ZW50RGF0YSxcclxuICAgICAgICAgICAgZGF0YToge2JhcjogJ2Jheid9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcclxuICAgIH1cclxufSIsImltcG9ydCB7QmFzZVNlcnZlckV2ZW50c0RyaXZlcn0gZnJvbSBcIi4vQmFzZVNlcnZlckV2ZW50c0RyaXZlclwiO1xyXG5cclxuLyoqXHJcbiAqIFNlcnZlciBzZW50IGV2ZW50cyBkcml2ZXJcclxuICogQHBhY2thZ2UgQ290b250aVxyXG4gKiBAY29weXJpZ2h0IChjKSBDb3RvbnRpIFRlYW1cclxuICogQGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1NlcnZlci1zZW50X2V2ZW50cy9Vc2luZ19zZXJ2ZXItc2VudF9ldmVudHNcclxuICovXHJcbmV4cG9ydCBjbGFzcyBTZXJ2ZXJFdmVudHNTU0VEcml2ZXIgZXh0ZW5kcyBCYXNlU2VydmVyRXZlbnRzRHJpdmVyIHtcclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge0V2ZW50U291cmNlfG51bGx9XHJcbiAgICAgKi9cclxuICAgICNldmVudFNvdXJjZSA9IG51bGw7XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy4jZXZlbnRTb3VyY2UgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpbml0IFNlcnZlckV2ZW50c1NTRURyaXZlci4gJywgdGhpcy5ldmVudHNVcmwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4jZXZlbnRTb3VyY2UgPSBuZXcgRXZlbnRTb3VyY2UodGhpcy5ldmVudHNVcmwpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgdGhpcy4jZXZlbnRTb3VyY2Uub25vcGVuID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmVyRXZlbnRzU1NFRHJpdmVyIGNvbm5lY3Rpb24gaXMgb3BlbicpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4jZXZlbnRTb3VyY2Uub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChldmVudERhdGEuZGF0YSAhPT0gdW5kZWZpbmVkICYmICh0eXBlb2YgZXZlbnREYXRhLmRhdGEgPT09ICdzdHJpbmcnKSAmJiBldmVudERhdGEuZGF0YSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50RGF0YS5kYXRhID0gSlNPTi5wYXJzZShldmVudERhdGEuZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXZlbnREYXRhLmV2ZW50SWQgPSBldmVudC5sYXN0RXZlbnRJZDtcclxuICAgICAgICAgICAgdGhpcy5vbkV2ZW50VHJpZ2dlcmVkKGV2ZW50RGF0YSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuI2V2ZW50U291cmNlLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZXJ2ZXJFdmVudHNTU0VEcml2ZXIgY29ubmVjdGlvbiBlcnJvcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtCYXNlU2VydmVyRXZlbnRzRHJpdmVyfSBmcm9tIFwiLi9CYXNlU2VydmVyRXZlbnRzRHJpdmVyXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU2VydmVyRXZlbnRzQWpheERyaXZlciBleHRlbmRzIEJhc2VTZXJ2ZXJFdmVudHNEcml2ZXIge1xyXG5cclxufSIsImltcG9ydCB7U2VydmVyRXZlbnRzU1NFRHJpdmVyfSBmcm9tIFwiLi9TZXJ2ZXJFdmVudHNTU0VEcml2ZXJcIjtcclxuaW1wb3J0IHtTZXJ2ZXJFdmVudHNBamF4RHJpdmVyfSBmcm9tIFwiLi9TZXJ2ZXJFdmVudHNBamF4RHJpdmVyXCI7XHJcblxyXG4vKipcclxuICogQmFzZSBzZXJ2ZXIgZXZlbnRzIGRyaXZlclxyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNlcnZlckV2ZW50c0RyaXZlckZhY3Rvcnkge1xyXG4gICAgI2Jhc2VVcmwgPSAnLyc7XHJcblxyXG4gICAgI21vZGUgPSAncHJvZHVjdGlvbidcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihiYXNlVXJsID0gbnVsbCwgbW9kZSA9IG51bGwpIHtcclxuICAgICAgICBpZiAoYmFzZVVybCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLiNiYXNlVXJsID0gYmFzZVVybDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1vZGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy4jbW9kZSA9IG1vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGRyaXZlclR5cGVcclxuICAgICAqIEByZXR1cm5zIHtTZXJ2ZXJFdmVudHNTU0VEcml2ZXJ8U2VydmVyRXZlbnRzQWpheERyaXZlcn1cclxuICAgICAqL1xyXG4gICAgZ2V0QnlUeXBlKGRyaXZlclR5cGUpIHtcclxuICAgICAgICBsZXQgZHJpdmVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3Qgc2VydmVyU2VudEV2ZW50c1VybCA9IHRoaXMuI2Jhc2VVcmwgKyAnP249c2VydmVyLWV2ZW50cyZhPXNzZSc7XHJcbiAgICAgICAgY29uc3QgYWpheEV2ZW50c1VybCA9IHRoaXMuI2Jhc2VVcmwgKyAnP249c2VydmVyLWV2ZW50cyZhPWFqYXgnO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGRyaXZlclR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnc2VydmVyU2VudEV2ZW50cyc6XHJcbiAgICAgICAgICAgICAgICBkcml2ZXIgPSBuZXcgU2VydmVyRXZlbnRzU1NFRHJpdmVyKHNlcnZlclNlbnRFdmVudHNVcmwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuI21vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2luZyBTZXJ2ZXJFdmVudHNTU0VEcml2ZXInLCBzZXJ2ZXJTZW50RXZlbnRzVXJsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGRyaXZlciA9IG5ldyBTZXJ2ZXJFdmVudHNBamF4RHJpdmVyKGFqYXhFdmVudHNVcmwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuI21vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2luZyBTZXJ2ZXJFdmVudHNBamF4RHJpdmVyJywgYWpheEV2ZW50c1VybCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZHJpdmVyO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtTZXJ2ZXJFdmVudHNEcml2ZXJGYWN0b3J5fSBmcm9tIFwiLi9kcml2ZXIvU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeVwiO1xyXG5cclxuLyoqXHJcbiAqIFNoYXJlZCB3b3JrZXIgZm9yIFNlcnZlciBTZW50IEV2ZW50c1xyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKiBAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvU2VydmVyLXNlbnRfZXZlbnRzL1VzaW5nX3NlcnZlci1zZW50X2V2ZW50c1xyXG4gKi9cclxuY2xhc3MgU2VydmVyU2VudEV2ZW50cyB7XHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtTZXJ2ZXJFdmVudHNBamF4RHJpdmVyfFNlcnZlckV2ZW50c1NTRURyaXZlcnxudWxsfVxyXG4gICAgICovXHJcbiAgICAjZHJpdmVyID0gbnVsbDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtzdHJpbmd8bnVsbH1cclxuICAgICAqL1xyXG4gICAgbW9kZSA9ICdwcm9kdWN0aW9uJztcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtzdHJpbmd8bnVsbH1cclxuICAgICAqL1xyXG4gICAgZHJpdmVyVHlwZSA9IG51bGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAgICovXHJcbiAgICBiYXNlVXJsID0gJy8nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge2Z1bmN0aW9ufG51bGx9XHJcbiAgICAgKi9cclxuICAgIG9uRXZlbnQgPSBudWxsO1xyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuI2RyaXZlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2luaXQgc2VydmVyIGV2ZW50cyBTaGFyZWQgd29ya2VyJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBmYWN0b3J5ID0gbmV3IFNlcnZlckV2ZW50c0RyaXZlckZhY3RvcnkodGhpcy5iYXNlVXJsLCB0aGlzLm1vZGUpO1xyXG5cclxuICAgICAgICB0aGlzLiNkcml2ZXIgPSBmYWN0b3J5LmdldEJ5VHlwZSh0aGlzLmRyaXZlclR5cGUpO1xyXG5cclxuICAgICAgICB0aGlzLiNkcml2ZXIuYWRkRXZlbnRMaXN0ZW5lcignZXZlbnQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9uRXZlbnQgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5jb25zdHJ1Y3Rvci5uYW1lICsgJy5vbkV2ZW50IGlzIG5vdCBkZWZpbmVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5vbkV2ZW50KGV2ZW50LmRldGFpbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy4jZHJpdmVyLmluaXQoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBAdHlwZSB7TWVzc2FnZVBvcnRbXX1cclxuICovXHJcbmNvbnN0IHBvcnRzID0gW107XHJcblxyXG4vKipcclxuICogQHR5cGUge1NlcnZlclNlbnRFdmVudHN8bnVsbH1cclxuICovXHJcbmxldCBldmVudHMgPSBudWxsO1xyXG5cclxuc2VsZi5vbmNvbm5lY3QgPSAoZXZlbnQpID0+IHtcclxuICAgIGNvbnN0IHBvcnQgPSBldmVudC5wb3J0c1swXTtcclxuXHJcbiAgICBwb3J0cy5wdXNoKHBvcnQpO1xyXG5cclxuICAgIGlmIChldmVudHMgPT09IG51bGwpIHtcclxuICAgICAgICBldmVudHMgPSBuZXcgU2VydmVyU2VudEV2ZW50cygpO1xyXG4gICAgICAgIGV2ZW50cy5vbkV2ZW50ID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChldmVudHMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2hhcmVkIHdvcmtlciBwb3N0TWVzc2FnZScsIGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yIChjb25zdCBjbGllbnQgb2YgcG9ydHMpIHtcclxuICAgICAgICAgICAgICAgIGNsaWVudC5wb3N0TWVzc2FnZShldmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcG9ydC5vbm1lc3NhZ2UgPSAoZSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlLmRhdGE7XHJcblxyXG4gICAgICAgIGlmIChtZXNzYWdlLmNvbmZpZyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudHMuZHJpdmVyVHlwZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZXZlbnRzLmRyaXZlclR5cGUgPSBtZXNzYWdlLmNvbmZpZy5kcml2ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXZlbnRzLm1vZGUgPSBtZXNzYWdlLmNvbmZpZy5tb2RlO1xyXG4gICAgICAgICAgICBldmVudHMuYmFzZVVybCA9IG1lc3NhZ2UuY29uZmlnLmJhc2VVcmw7XHJcbiAgICAgICAgICAgIGV2ZW50cy5pbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnRzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU2hhcmVkIHdvcmtlciBtZXNzYWdlJywgbWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJCYXNlU2VydmVyRXZlbnRzRHJpdmVyIiwiRXZlbnRUYXJnZXQiLCJtb2RlIiwiZXZlbnRzVXJsIiwiY29uc3RydWN0b3IiLCJzdXBlciIsInRoaXMiLCJpbml0Iiwib25FdmVudFRyaWdnZXJlZCIsImV2ZW50RGF0YSIsImNvbnNvbGUiLCJsb2ciLCJldmVudCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwiZGF0YSIsImJhciIsImRpc3BhdGNoRXZlbnQiLCJTZXJ2ZXJFdmVudHNTU0VEcml2ZXIiLCJFdmVudFNvdXJjZSIsIm9ub3BlbiIsIm9ubWVzc2FnZSIsIkpTT04iLCJwYXJzZSIsInVuZGVmaW5lZCIsImV2ZW50SWQiLCJsYXN0RXZlbnRJZCIsIm9uZXJyb3IiLCJTZXJ2ZXJFdmVudHNBamF4RHJpdmVyIiwiU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeSIsImJhc2VVcmwiLCJnZXRCeVR5cGUiLCJkcml2ZXJUeXBlIiwiZHJpdmVyIiwic2VydmVyU2VudEV2ZW50c1VybCIsImFqYXhFdmVudHNVcmwiLCJTZXJ2ZXJTZW50RXZlbnRzIiwib25FdmVudCIsImZhY3RvcnkiLCJhZGRFdmVudExpc3RlbmVyIiwiZXJyb3IiLCJuYW1lIiwicG9ydHMiLCJldmVudHMiLCJzZWxmIiwib25jb25uZWN0IiwicG9ydCIsInB1c2giLCJjbGllbnQiLCJwb3N0TWVzc2FnZSIsImUiLCJtZXNzYWdlIiwiY29uZmlnIl0sInNvdXJjZVJvb3QiOiIifQ==