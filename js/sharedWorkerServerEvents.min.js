(()=>{"use strict";class e extends EventTarget{mode="production";eventsUrl=null;constructor(e,t=null){super(),null!==t&&""!==t&&(this.mode=t),this.eventsUrl=e}init(){}onEventTriggered(e){"production"!==this.mode&&console.log("ServerEventsDriver: Server triggered event",e);const t=new CustomEvent("event",{detail:e});this.dispatchEvent(t)}}class t extends e{#e=null;init(){null===this.#e&&("production"!==this.mode&&console.log("init ServerEventsSSEDriver. ",this.eventsUrl),this.#e=new EventSource(this.eventsUrl),"production"!==this.mode&&(this.#e.onopen=function(e){console.log("ServerEventsSSEDriver connection is open")}),this.#e.onmessage=e=>{const t=JSON.parse(e.data);void 0!==t.data&&"string"==typeof t.data&&""!==t.data&&(t.data=JSON.parse(t.data)),t.eventId=e.lastEventId,this.onEventTriggered(t)},"production"!==this.mode&&(this.#e.onerror=function(e){console.log("ServerEventsSSEDriver connection error")}))}}class n extends e{#t=3e3;#n=null;#s=!1;init(){this.#s||(this.#s=!0,"production"!==this.mode&&console.log("init ServerEventsAjaxDriver ",this.eventsUrl),this.#n=setTimeout((()=>this.#o()),500))}async#o(){try{const e=await fetch(this.eventsUrl);if(!e.ok)throw new Error(`Response status: ${e.status}`);const t=await e.json();void 0!==t.events&&t.events.forEach((e=>{e.eventId=void 0!==e.id?e.id:null,this.onEventTriggered(e)})),this.#n=setTimeout((()=>this.#o()),this.#t)}catch(e){console.log("ServerEventsAjaxDriver get events error: "+e.message),this.#n=setTimeout((()=>this.#o()),this.#t)}}}class s{#r="/";#i="production";constructor(e=null,t=null){null!==e&&(this.#r=e),null!==t&&(this.#i=t)}getByType(e){let s=null;const o=this.#r+"?n=server-events&a=sse",r=this.#r+"?n=server-events&a=ajax&_ajax=1";return"sse"===e?(s=new t(o),"production"!==this.#i&&console.log("using ServerEventsSSEDriver",o)):(s=new n(r),"production"!==this.#i&&console.log("using ServerEventsAjaxDriver",r)),s}}class o{#l=null;mode="production";driverType=null;baseUrl="/";onEvent=null;init(){if(null!==this.#l)return;"production"!==this.mode&&console.log("init server events Shared worker");const e=new s(this.baseUrl,this.mode);this.#l=e.getByType(this.driverType),this.#l.addEventListener("event",(e=>{"function"!=typeof this.onEvent&&console.error(this.constructor.name+".onEvent is not defined"),this.onEvent(e.detail)})),this.#l.init()}}const r=[];let i=null;self.onconnect=e=>{const t=e.ports[0];r.push(t),null===i&&(i=new o,i.onEvent=e=>{"production"!==i.mode&&console.log("Shared worker postMessage",e);for(const t of r)t.postMessage(e)}),t.onmessage=e=>{const t=e.data;void 0!==t.config&&(null===i.driverType&&(i.driverType=t.config.driver),i.mode=t.config.mode,i.baseUrl=t.config.baseUrl,i.init()),"production"!==i.mode&&console.log("Shared worker message",t)}}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixFQUN6QyxDQUNKLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jb3RvbnRpLy4vc3JjL3NlcnZlckV2ZW50cy9kcml2ZXIvQmFzZVNlcnZlckV2ZW50c0RyaXZlci5qcyIsIndlYnBhY2s6Ly9jb3RvbnRpLy4vc3JjL3NlcnZlckV2ZW50cy9kcml2ZXIvU2VydmVyRXZlbnRzU1NFRHJpdmVyLmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL2RyaXZlci9TZXJ2ZXJFdmVudHNBamF4RHJpdmVyLmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL2RyaXZlci9TZXJ2ZXJFdmVudHNEcml2ZXJGYWN0b3J5LmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL3NoYXJlZFdvcmtlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQmFzZSBzZXJ2ZXIgZXZlbnRzIGRyaXZlclxyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEJhc2VTZXJ2ZXJFdmVudHNEcml2ZXIgZXh0ZW5kcyBFdmVudFRhcmdldCB7XHJcbiAgICBtb2RlID0gJ3Byb2R1Y3Rpb24nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge3N0cmluZ3xudWxsfVxyXG4gICAgICovXHJcbiAgICBldmVudHNVcmwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGV2ZW50c1VybCwgbW9kZSA9IG51bGwpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICBpZiAobW9kZSAhPT0gbnVsbCAmJiBtb2RlICE9PSAnJykge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV2ZW50c1VybCA9IGV2ZW50c1VybDtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkgeyB9XHJcblxyXG4gICAgb25FdmVudFRyaWdnZXJlZChldmVudERhdGEpIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlcnZlckV2ZW50c0RyaXZlcjogU2VydmVyIHRyaWdnZXJlZCBldmVudCcsIGV2ZW50RGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBldmVudCA9IG5ldyBDdXN0b21FdmVudCgnZXZlbnQnLCB7ZGV0YWlsOiBldmVudERhdGF9KTtcclxuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtCYXNlU2VydmVyRXZlbnRzRHJpdmVyfSBmcm9tIFwiLi9CYXNlU2VydmVyRXZlbnRzRHJpdmVyXCI7XHJcblxyXG4vKipcclxuICogU2VydmVyIC0gU2VudCBldmVudHMgZHJpdmVyXHJcbiAqIEBwYWNrYWdlIENvdG9udGlcclxuICogQGNvcHlyaWdodCAoYykgQ290b250aSBUZWFtXHJcbiAqIEBsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9TZXJ2ZXItc2VudF9ldmVudHMvVXNpbmdfc2VydmVyLXNlbnRfZXZlbnRzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2VydmVyRXZlbnRzU1NFRHJpdmVyIGV4dGVuZHMgQmFzZVNlcnZlckV2ZW50c0RyaXZlciB7XHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtFdmVudFNvdXJjZXxudWxsfVxyXG4gICAgICovXHJcbiAgICAjZXZlbnRTb3VyY2UgPSBudWxsO1xyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuI2V2ZW50U291cmNlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaW5pdCBTZXJ2ZXJFdmVudHNTU0VEcml2ZXIuICcsIHRoaXMuZXZlbnRzVXJsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuI2V2ZW50U291cmNlID0gbmV3IEV2ZW50U291cmNlKHRoaXMuZXZlbnRzVXJsKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuI2V2ZW50U291cmNlLm9ub3BlbiA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlcnZlckV2ZW50c1NTRURyaXZlciBjb25uZWN0aW9uIGlzIG9wZW4nKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuI2V2ZW50U291cmNlLm9ubWVzc2FnZSA9IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBldmVudERhdGEgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xyXG4gICAgICAgICAgICBpZiAoZXZlbnREYXRhLmRhdGEgIT09IHVuZGVmaW5lZCAmJiAodHlwZW9mIGV2ZW50RGF0YS5kYXRhID09PSAnc3RyaW5nJykgJiYgZXZlbnREYXRhLmRhdGEgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBldmVudERhdGEuZGF0YSA9IEpTT04ucGFyc2UoZXZlbnREYXRhLmRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGV2ZW50RGF0YS5ldmVudElkID0gZXZlbnQubGFzdEV2ZW50SWQ7XHJcbiAgICAgICAgICAgIHRoaXMub25FdmVudFRyaWdnZXJlZChldmVudERhdGEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICB0aGlzLiNldmVudFNvdXJjZS5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmVyRXZlbnRzU1NFRHJpdmVyIGNvbm5lY3Rpb24gZXJyb3InKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsImltcG9ydCB7QmFzZVNlcnZlckV2ZW50c0RyaXZlcn0gZnJvbSBcIi4vQmFzZVNlcnZlckV2ZW50c0RyaXZlclwiO1xyXG5cclxuLyoqXHJcbiAqIFNlcnZlciBldmVudHMgYWpheCBkcml2ZXJcclxuICogQHBhY2thZ2UgQ290b250aVxyXG4gKiBAY29weXJpZ2h0IChjKSBDb3RvbnRpIFRlYW1cclxuICovXHJcbmV4cG9ydCBjbGFzcyBTZXJ2ZXJFdmVudHNBamF4RHJpdmVyIGV4dGVuZHMgQmFzZVNlcnZlckV2ZW50c0RyaXZlciB7XHJcbiAgICAjdGltZU91dFBlcmlvZCA9IDMwMDA7IC8vIDMgc2VjLlxyXG5cclxuICAgICN0aW1lcklkID0gbnVsbDtcclxuXHJcbiAgICAjaW5pdGVkID0gZmFsc2U7XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy4jaW5pdGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuI2luaXRlZCA9IHRydWU7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaW5pdCBTZXJ2ZXJFdmVudHNBamF4RHJpdmVyICcsIHRoaXMuZXZlbnRzVXJsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuI3RpbWVySWQgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuI2dldEV2ZW50cygpLCA1MDApO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jICNnZXRFdmVudHMoKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLmV2ZW50c1VybCk7XHJcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUmVzcG9uc2Ugc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0LmV2ZW50cyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuZXZlbnRzLmZvckVhY2goKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZXZlbnRJZCA9IGV2ZW50LmlkICE9PSB1bmRlZmluZWQgPyBldmVudC5pZCA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkV2ZW50VHJpZ2dlcmVkKGV2ZW50KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLiN0aW1lcklkID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLiNnZXRFdmVudHMoKSwgdGhpcy4jdGltZU91dFBlcmlvZCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlcnZlckV2ZW50c0FqYXhEcml2ZXIgZ2V0IGV2ZW50cyBlcnJvcjogJyArIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB0aGlzLiN0aW1lcklkID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLiNnZXRFdmVudHMoKSwgdGhpcy4jdGltZU91dFBlcmlvZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtTZXJ2ZXJFdmVudHNTU0VEcml2ZXJ9IGZyb20gXCIuL1NlcnZlckV2ZW50c1NTRURyaXZlclwiO1xyXG5pbXBvcnQge1NlcnZlckV2ZW50c0FqYXhEcml2ZXJ9IGZyb20gXCIuL1NlcnZlckV2ZW50c0FqYXhEcml2ZXJcIjtcclxuXHJcbi8qKlxyXG4gKiBCYXNlIHNlcnZlciBldmVudHMgZHJpdmVyXHJcbiAqIEBwYWNrYWdlIENvdG9udGlcclxuICogQGNvcHlyaWdodCAoYykgQ290b250aSBUZWFtXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeSB7XHJcbiAgICAjYmFzZVVybCA9ICcvJztcclxuXHJcbiAgICAjbW9kZSA9ICdwcm9kdWN0aW9uJ1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGJhc2VVcmwgPSBudWxsLCBtb2RlID0gbnVsbCkge1xyXG4gICAgICAgIGlmIChiYXNlVXJsICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuI2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobW9kZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLiNtb2RlID0gbW9kZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZHJpdmVyVHlwZVxyXG4gICAgICogQHJldHVybnMge1NlcnZlckV2ZW50c1NTRURyaXZlcnxTZXJ2ZXJFdmVudHNBamF4RHJpdmVyfVxyXG4gICAgICovXHJcbiAgICBnZXRCeVR5cGUoZHJpdmVyVHlwZSkge1xyXG4gICAgICAgIGxldCBkcml2ZXIgPSBudWxsO1xyXG5cclxuICAgICAgICBjb25zdCBzZXJ2ZXJTZW50RXZlbnRzVXJsID0gdGhpcy4jYmFzZVVybCArICc/bj1zZXJ2ZXItZXZlbnRzJmE9c3NlJztcclxuICAgICAgICBjb25zdCBhamF4RXZlbnRzVXJsID0gdGhpcy4jYmFzZVVybCArICc/bj1zZXJ2ZXItZXZlbnRzJmE9YWpheCZfYWpheD0xJztcclxuXHJcbiAgICAgICAgc3dpdGNoIChkcml2ZXJUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ3NzZSc6XHJcbiAgICAgICAgICAgICAgICAvLyBTZXJ2ZXItU2VudCBldmVudHMgZHJpdmVyXHJcbiAgICAgICAgICAgICAgICBkcml2ZXIgPSBuZXcgU2VydmVyRXZlbnRzU1NFRHJpdmVyKHNlcnZlclNlbnRFdmVudHNVcmwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuI21vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2luZyBTZXJ2ZXJFdmVudHNTU0VEcml2ZXInLCBzZXJ2ZXJTZW50RXZlbnRzVXJsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGRyaXZlciA9IG5ldyBTZXJ2ZXJFdmVudHNBamF4RHJpdmVyKGFqYXhFdmVudHNVcmwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuI21vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2luZyBTZXJ2ZXJFdmVudHNBamF4RHJpdmVyJywgYWpheEV2ZW50c1VybCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZHJpdmVyO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtTZXJ2ZXJFdmVudHNEcml2ZXJGYWN0b3J5fSBmcm9tIFwiLi9kcml2ZXIvU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeVwiO1xyXG5cclxuLyoqXHJcbiAqIFNoYXJlZCB3b3JrZXIgZm9yIFNlcnZlciBTZW50IEV2ZW50c1xyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKiBAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvU2VydmVyLXNlbnRfZXZlbnRzL1VzaW5nX3NlcnZlci1zZW50X2V2ZW50c1xyXG4gKi9cclxuY2xhc3MgU2VydmVyU2VudEV2ZW50cyB7XHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtTZXJ2ZXJFdmVudHNBamF4RHJpdmVyfFNlcnZlckV2ZW50c1NTRURyaXZlcnxudWxsfVxyXG4gICAgICovXHJcbiAgICAjZHJpdmVyID0gbnVsbDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtzdHJpbmd8bnVsbH1cclxuICAgICAqL1xyXG4gICAgbW9kZSA9ICdwcm9kdWN0aW9uJztcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtzdHJpbmd8bnVsbH1cclxuICAgICAqL1xyXG4gICAgZHJpdmVyVHlwZSA9IG51bGw7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAgICovXHJcbiAgICBiYXNlVXJsID0gJy8nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge2Z1bmN0aW9ufG51bGx9XHJcbiAgICAgKi9cclxuICAgIG9uRXZlbnQgPSBudWxsO1xyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuI2RyaXZlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2luaXQgc2VydmVyIGV2ZW50cyBTaGFyZWQgd29ya2VyJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBmYWN0b3J5ID0gbmV3IFNlcnZlckV2ZW50c0RyaXZlckZhY3RvcnkodGhpcy5iYXNlVXJsLCB0aGlzLm1vZGUpO1xyXG5cclxuICAgICAgICB0aGlzLiNkcml2ZXIgPSBmYWN0b3J5LmdldEJ5VHlwZSh0aGlzLmRyaXZlclR5cGUpO1xyXG5cclxuICAgICAgICB0aGlzLiNkcml2ZXIuYWRkRXZlbnRMaXN0ZW5lcignZXZlbnQnLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9uRXZlbnQgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5jb25zdHJ1Y3Rvci5uYW1lICsgJy5vbkV2ZW50IGlzIG5vdCBkZWZpbmVkJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5vbkV2ZW50KGV2ZW50LmRldGFpbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy4jZHJpdmVyLmluaXQoKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEB0eXBlIHtNZXNzYWdlUG9ydFtdfVxyXG4gKi9cclxuY29uc3QgcG9ydHMgPSBbXTtcclxuXHJcbi8qKlxyXG4gKiBAdHlwZSB7U2VydmVyU2VudEV2ZW50c3xudWxsfVxyXG4gKi9cclxubGV0IGV2ZW50cyA9IG51bGw7XHJcblxyXG5zZWxmLm9uY29ubmVjdCA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3QgcG9ydCA9IGV2ZW50LnBvcnRzWzBdO1xyXG5cclxuICAgIHBvcnRzLnB1c2gocG9ydCk7XHJcblxyXG4gICAgaWYgKGV2ZW50cyA9PT0gbnVsbCkge1xyXG4gICAgICAgIGV2ZW50cyA9IG5ldyBTZXJ2ZXJTZW50RXZlbnRzKCk7XHJcbiAgICAgICAgZXZlbnRzLm9uRXZlbnQgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTaGFyZWQgd29ya2VyIHBvc3RNZXNzYWdlJywgZXZlbnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNsaWVudCBvZiBwb3J0cykge1xyXG4gICAgICAgICAgICAgICAgY2xpZW50LnBvc3RNZXNzYWdlKGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwb3J0Lm9ubWVzc2FnZSA9IChlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGUuZGF0YTtcclxuXHJcbiAgICAgICAgaWYgKG1lc3NhZ2UuY29uZmlnICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50cy5kcml2ZXJUeXBlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBldmVudHMuZHJpdmVyVHlwZSA9IG1lc3NhZ2UuY29uZmlnLmRyaXZlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBldmVudHMubW9kZSA9IG1lc3NhZ2UuY29uZmlnLm1vZGU7XHJcbiAgICAgICAgICAgIGV2ZW50cy5iYXNlVXJsID0gbWVzc2FnZS5jb25maWcuYmFzZVVybDtcclxuICAgICAgICAgICAgZXZlbnRzLmluaXQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChldmVudHMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTaGFyZWQgd29ya2VyIG1lc3NhZ2UnLCBtZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkJhc2VTZXJ2ZXJFdmVudHNEcml2ZXIiLCJFdmVudFRhcmdldCIsIm1vZGUiLCJldmVudHNVcmwiLCJjb25zdHJ1Y3RvciIsInN1cGVyIiwidGhpcyIsImluaXQiLCJvbkV2ZW50VHJpZ2dlcmVkIiwiZXZlbnREYXRhIiwiY29uc29sZSIsImxvZyIsImV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJkaXNwYXRjaEV2ZW50IiwiU2VydmVyRXZlbnRzU1NFRHJpdmVyIiwiRXZlbnRTb3VyY2UiLCJvbm9wZW4iLCJvbm1lc3NhZ2UiLCJKU09OIiwicGFyc2UiLCJkYXRhIiwidW5kZWZpbmVkIiwiZXZlbnRJZCIsImxhc3RFdmVudElkIiwib25lcnJvciIsIlNlcnZlckV2ZW50c0FqYXhEcml2ZXIiLCJzZXRUaW1lb3V0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm9rIiwiRXJyb3IiLCJzdGF0dXMiLCJyZXN1bHQiLCJqc29uIiwiZXZlbnRzIiwiZm9yRWFjaCIsImlkIiwiZXJyb3IiLCJtZXNzYWdlIiwiU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeSIsImJhc2VVcmwiLCJnZXRCeVR5cGUiLCJkcml2ZXJUeXBlIiwiZHJpdmVyIiwic2VydmVyU2VudEV2ZW50c1VybCIsImFqYXhFdmVudHNVcmwiLCJTZXJ2ZXJTZW50RXZlbnRzIiwib25FdmVudCIsImZhY3RvcnkiLCJhZGRFdmVudExpc3RlbmVyIiwibmFtZSIsInBvcnRzIiwic2VsZiIsIm9uY29ubmVjdCIsInBvcnQiLCJwdXNoIiwiY2xpZW50IiwicG9zdE1lc3NhZ2UiLCJlIiwiY29uZmlnIl0sInNvdXJjZVJvb3QiOiIifQ==