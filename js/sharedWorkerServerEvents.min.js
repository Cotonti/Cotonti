(()=>{"use strict";class e extends EventTarget{mode="production";eventsUrl=null;constructor(e,t=null){super(),null!==t&&""!==t&&(this.mode=t),this.eventsUrl=e}init(){}onEventTriggered(e){"production"!==this.mode&&console.log("ServerEventsDriver: Server triggered event",e);const t=new CustomEvent("event",{detail:e});this.dispatchEvent(t)}}class t extends e{#e=null;init(){if(null!==this.#e)return;"production"!==this.mode&&console.log("init ServerEventsSSEDriver. ",this.eventsUrl);const e=this.eventsUrl+"&ts="+Date.now();this.#e=new EventSource(e),"production"!==this.mode&&(this.#e.onopen=function(e){console.log("ServerEventsSSEDriver connection is open")}),this.#e.onmessage=e=>{const t=JSON.parse(e.data);void 0!==t.data&&"string"==typeof t.data&&""!==t.data&&(t.data=JSON.parse(t.data)),t.eventId=e.lastEventId,this.onEventTriggered(t)},"production"!==this.mode&&(this.#e.onerror=function(e){console.log("ServerEventsSSEDriver connection error")})}}class n extends e{#t=6e3;#n=null;#s=!1;init(){this.#s||(this.#s=!0,"production"!==this.mode&&console.log("init ServerEventsAjaxDriver ",this.eventsUrl),this.#n=setTimeout((()=>this.#o()),500))}async#o(){try{const e=this.eventsUrl+"&ts="+Date.now(),t=await fetch(e);if(!t.ok)throw new Error(`Response status: ${t.status}`);const n=await t.json();void 0!==n.events&&n.events.forEach((e=>{e.eventId=void 0!==e.id?e.id:null,this.onEventTriggered(e)})),this.#n=setTimeout((()=>this.#o()),this.#t)}catch(e){console.log("ServerEventsAjaxDriver get events error: "+e.message),this.#n=setTimeout((()=>this.#o()),this.#t)}}}class s{#r="/";#i="production";constructor(e=null,t=null){null!==e&&(this.#r=e),null!==t&&(this.#i=t)}getByType(e){let s=null;const o=this.#r+"?n=server-events&a=sse",r=this.#r+"?n=server-events&a=ajax&_ajax=1";return"sse"===e?(s=new t(o),"production"!==this.#i&&console.log("using ServerEventsSSEDriver",o)):(s=new n(r),"production"!==this.#i&&console.log("using ServerEventsAjaxDriver",r)),s}}class o{#l=null;mode="production";driverType=null;baseUrl="/";onEvent=null;init(){if(null!==this.#l)return;"production"!==this.mode&&console.log("init server events Shared worker");const e=new s(this.baseUrl,this.mode);this.#l=e.getByType(this.driverType),this.#l.addEventListener("event",(e=>{"function"!=typeof this.onEvent&&console.error(this.constructor.name+".onEvent is not defined"),this.onEvent(e.detail)})),this.#l.init()}}const r=[];let i=null;self.onconnect=e=>{const t=e.ports[0];r.push(t),null===i&&(i=new o,i.onEvent=e=>{"production"!==i.mode&&console.log("Shared worker postMessage",e);for(const t of r)t.postMessage(e)}),t.onmessage=e=>{const t=e.data;void 0!==t.config&&(null===i.driverType&&(i.driverType=t.config.driver),i.mode=t.config.mode,i.baseUrl=t.config.baseUrl,i.init()),"production"!==i.mode&&console.log("Shared worker message",t)}}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cUMsRUFBT00sUUFBVUYsRUFBUXFCLE9BQU9uQixRQUNoQ04sRUFBT2hDLFFBR1MsZUFBaEJnQyxFQUFPckMsTUFDUFEsUUFBUUMsSUFBSSx3QkFBeUJnQyxFQUN6QyxDQUNKLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jb3RvbnRpLy4vc3JjL3NlcnZlckV2ZW50cy9kcml2ZXIvQmFzZVNlcnZlckV2ZW50c0RyaXZlci5qcyIsIndlYnBhY2s6Ly9jb3RvbnRpLy4vc3JjL3NlcnZlckV2ZW50cy9kcml2ZXIvU2VydmVyRXZlbnRzU1NFRHJpdmVyLmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL2RyaXZlci9TZXJ2ZXJFdmVudHNBamF4RHJpdmVyLmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL2RyaXZlci9TZXJ2ZXJFdmVudHNEcml2ZXJGYWN0b3J5LmpzIiwid2VicGFjazovL2NvdG9udGkvLi9zcmMvc2VydmVyRXZlbnRzL3NoYXJlZFdvcmtlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQmFzZSBzZXJ2ZXIgZXZlbnRzIGRyaXZlclxyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEJhc2VTZXJ2ZXJFdmVudHNEcml2ZXIgZXh0ZW5kcyBFdmVudFRhcmdldCB7XHJcbiAgICBtb2RlID0gJ3Byb2R1Y3Rpb24nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge3N0cmluZ3xudWxsfVxyXG4gICAgICovXHJcbiAgICBldmVudHNVcmwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGV2ZW50c1VybCwgbW9kZSA9IG51bGwpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG5cclxuICAgICAgICBpZiAobW9kZSAhPT0gbnVsbCAmJiBtb2RlICE9PSAnJykge1xyXG4gICAgICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmV2ZW50c1VybCA9IGV2ZW50c1VybDtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCkgeyB9XHJcblxyXG4gICAgb25FdmVudFRyaWdnZXJlZChldmVudERhdGEpIHtcclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlcnZlckV2ZW50c0RyaXZlcjogU2VydmVyIHRyaWdnZXJlZCBldmVudCcsIGV2ZW50RGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBldmVudCA9IG5ldyBDdXN0b21FdmVudCgnZXZlbnQnLCB7ZGV0YWlsOiBldmVudERhdGF9KTtcclxuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtCYXNlU2VydmVyRXZlbnRzRHJpdmVyfSBmcm9tIFwiLi9CYXNlU2VydmVyRXZlbnRzRHJpdmVyXCI7XHJcblxyXG4vKipcclxuICogU2VydmVyIC0gU2VudCBldmVudHMgZHJpdmVyXHJcbiAqIEBwYWNrYWdlIENvdG9udGlcclxuICogQGNvcHlyaWdodCAoYykgQ290b250aSBUZWFtXHJcbiAqIEBsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9TZXJ2ZXItc2VudF9ldmVudHMvVXNpbmdfc2VydmVyLXNlbnRfZXZlbnRzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2VydmVyRXZlbnRzU1NFRHJpdmVyIGV4dGVuZHMgQmFzZVNlcnZlckV2ZW50c0RyaXZlciB7XHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtFdmVudFNvdXJjZXxudWxsfVxyXG4gICAgICovXHJcbiAgICAjZXZlbnRTb3VyY2UgPSBudWxsO1xyXG5cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuI2V2ZW50U291cmNlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaW5pdCBTZXJ2ZXJFdmVudHNTU0VEcml2ZXIuICcsIHRoaXMuZXZlbnRzVXJsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMuZXZlbnRzVXJsICsgJyZ0cz0nICsgRGF0ZS5ub3coKTtcclxuICAgICAgICB0aGlzLiNldmVudFNvdXJjZSA9IG5ldyBFdmVudFNvdXJjZSh1cmwpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgdGhpcy4jZXZlbnRTb3VyY2Uub25vcGVuID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmVyRXZlbnRzU1NFRHJpdmVyIGNvbm5lY3Rpb24gaXMgb3BlbicpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4jZXZlbnRTb3VyY2Uub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChldmVudERhdGEuZGF0YSAhPT0gdW5kZWZpbmVkICYmICh0eXBlb2YgZXZlbnREYXRhLmRhdGEgPT09ICdzdHJpbmcnKSAmJiBldmVudERhdGEuZGF0YSAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50RGF0YS5kYXRhID0gSlNPTi5wYXJzZShldmVudERhdGEuZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZXZlbnREYXRhLmV2ZW50SWQgPSBldmVudC5sYXN0RXZlbnRJZDtcclxuICAgICAgICAgICAgdGhpcy5vbkV2ZW50VHJpZ2dlcmVkKGV2ZW50RGF0YSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuI2V2ZW50U291cmNlLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZXJ2ZXJFdmVudHNTU0VEcml2ZXIgY29ubmVjdGlvbiBlcnJvcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtCYXNlU2VydmVyRXZlbnRzRHJpdmVyfSBmcm9tIFwiLi9CYXNlU2VydmVyRXZlbnRzRHJpdmVyXCI7XHJcblxyXG4vKipcclxuICogU2VydmVyIGV2ZW50cyBhamF4IGRyaXZlclxyXG4gKiBAcGFja2FnZSBDb3RvbnRpXHJcbiAqIEBjb3B5cmlnaHQgKGMpIENvdG9udGkgVGVhbVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNlcnZlckV2ZW50c0FqYXhEcml2ZXIgZXh0ZW5kcyBCYXNlU2VydmVyRXZlbnRzRHJpdmVyIHtcclxuICAgICN0aW1lT3V0UGVyaW9kID0gNjAwMDsgLy8gNiBzZWMuXHJcblxyXG4gICAgI3RpbWVySWQgPSBudWxsO1xyXG5cclxuICAgICNpbml0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICBpbml0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLiNpbml0ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4jaW5pdGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpbml0IFNlcnZlckV2ZW50c0FqYXhEcml2ZXIgJywgdGhpcy5ldmVudHNVcmwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4jdGltZXJJZCA9IHNldFRpbWVvdXQoKCkgPT4gdGhpcy4jZ2V0RXZlbnRzKCksIDUwMCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgI2dldEV2ZW50cygpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmV2ZW50c1VybCArICcmdHM9JyArIERhdGUubm93KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTtcclxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXNwb25zZSBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuZXZlbnRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5ldmVudHMuZm9yRWFjaCgoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudC5ldmVudElkID0gZXZlbnQuaWQgIT09IHVuZGVmaW5lZCA/IGV2ZW50LmlkIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uRXZlbnRUcmlnZ2VyZWQoZXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuI3RpbWVySWQgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuI2dldEV2ZW50cygpLCB0aGlzLiN0aW1lT3V0UGVyaW9kKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU2VydmVyRXZlbnRzQWpheERyaXZlciBnZXQgZXZlbnRzIGVycm9yOiAnICsgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIHRoaXMuI3RpbWVySWQgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuI2dldEV2ZW50cygpLCB0aGlzLiN0aW1lT3V0UGVyaW9kKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQge1NlcnZlckV2ZW50c1NTRURyaXZlcn0gZnJvbSBcIi4vU2VydmVyRXZlbnRzU1NFRHJpdmVyXCI7XHJcbmltcG9ydCB7U2VydmVyRXZlbnRzQWpheERyaXZlcn0gZnJvbSBcIi4vU2VydmVyRXZlbnRzQWpheERyaXZlclwiO1xyXG5cclxuLyoqXHJcbiAqIEJhc2Ugc2VydmVyIGV2ZW50cyBkcml2ZXJcclxuICogQHBhY2thZ2UgQ290b250aVxyXG4gKiBAY29weXJpZ2h0IChjKSBDb3RvbnRpIFRlYW1cclxuICovXHJcbmV4cG9ydCBjbGFzcyBTZXJ2ZXJFdmVudHNEcml2ZXJGYWN0b3J5IHtcclxuICAgICNiYXNlVXJsID0gJy8nO1xyXG5cclxuICAgICNtb2RlID0gJ3Byb2R1Y3Rpb24nXHJcblxyXG4gICAgY29uc3RydWN0b3IoYmFzZVVybCA9IG51bGwsIG1vZGUgPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKGJhc2VVcmwgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy4jYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb2RlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuI21vZGUgPSBtb2RlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkcml2ZXJUeXBlXHJcbiAgICAgKiBAcmV0dXJucyB7U2VydmVyRXZlbnRzU1NFRHJpdmVyfFNlcnZlckV2ZW50c0FqYXhEcml2ZXJ9XHJcbiAgICAgKi9cclxuICAgIGdldEJ5VHlwZShkcml2ZXJUeXBlKSB7XHJcbiAgICAgICAgbGV0IGRyaXZlciA9IG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IHNlcnZlclNlbnRFdmVudHNVcmwgPSB0aGlzLiNiYXNlVXJsICsgJz9uPXNlcnZlci1ldmVudHMmYT1zc2UnO1xyXG4gICAgICAgIGNvbnN0IGFqYXhFdmVudHNVcmwgPSB0aGlzLiNiYXNlVXJsICsgJz9uPXNlcnZlci1ldmVudHMmYT1hamF4Jl9hamF4PTEnO1xyXG5cclxuICAgICAgICBzd2l0Y2ggKGRyaXZlclR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnc3NlJzpcclxuICAgICAgICAgICAgICAgIC8vIFNlcnZlci1TZW50IGV2ZW50cyBkcml2ZXJcclxuICAgICAgICAgICAgICAgIGRyaXZlciA9IG5ldyBTZXJ2ZXJFdmVudHNTU0VEcml2ZXIoc2VydmVyU2VudEV2ZW50c1VybCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4jbW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzaW5nIFNlcnZlckV2ZW50c1NTRURyaXZlcicsIHNlcnZlclNlbnRFdmVudHNVcmwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgZHJpdmVyID0gbmV3IFNlcnZlckV2ZW50c0FqYXhEcml2ZXIoYWpheEV2ZW50c1VybCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy4jbW9kZSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzaW5nIFNlcnZlckV2ZW50c0FqYXhEcml2ZXInLCBhamF4RXZlbnRzVXJsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkcml2ZXI7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQge1NlcnZlckV2ZW50c0RyaXZlckZhY3Rvcnl9IGZyb20gXCIuL2RyaXZlci9TZXJ2ZXJFdmVudHNEcml2ZXJGYWN0b3J5XCI7XHJcblxyXG4vKipcclxuICogU2hhcmVkIHdvcmtlciBmb3IgU2VydmVyIFNlbnQgRXZlbnRzXHJcbiAqIEBwYWNrYWdlIENvdG9udGlcclxuICogQGNvcHlyaWdodCAoYykgQ290b250aSBUZWFtXHJcbiAqIEBsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9TZXJ2ZXItc2VudF9ldmVudHMvVXNpbmdfc2VydmVyLXNlbnRfZXZlbnRzXHJcbiAqL1xyXG5jbGFzcyBTZXJ2ZXJTZW50RXZlbnRzIHtcclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge1NlcnZlckV2ZW50c0FqYXhEcml2ZXJ8U2VydmVyRXZlbnRzU1NFRHJpdmVyfG51bGx9XHJcbiAgICAgKi9cclxuICAgICNkcml2ZXIgPSBudWxsO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge3N0cmluZ3xudWxsfVxyXG4gICAgICovXHJcbiAgICBtb2RlID0gJ3Byb2R1Y3Rpb24nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHR5cGUge3N0cmluZ3xudWxsfVxyXG4gICAgICovXHJcbiAgICBkcml2ZXJUeXBlID0gbnVsbDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEB0eXBlIHtzdHJpbmd9XHJcbiAgICAgKi9cclxuICAgIGJhc2VVcmwgPSAnLyc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAdHlwZSB7ZnVuY3Rpb258bnVsbH1cclxuICAgICAqL1xyXG4gICAgb25FdmVudCA9IG51bGw7XHJcblxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBpZiAodGhpcy4jZHJpdmVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaW5pdCBzZXJ2ZXIgZXZlbnRzIFNoYXJlZCB3b3JrZXInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBuZXcgU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeSh0aGlzLmJhc2VVcmwsIHRoaXMubW9kZSk7XHJcblxyXG4gICAgICAgIHRoaXMuI2RyaXZlciA9IGZhY3RvcnkuZ2V0QnlUeXBlKHRoaXMuZHJpdmVyVHlwZSk7XHJcblxyXG4gICAgICAgIHRoaXMuI2RyaXZlci5hZGRFdmVudExpc3RlbmVyKCdldmVudCcsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub25FdmVudCAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmNvbnN0cnVjdG9yLm5hbWUgKyAnLm9uRXZlbnQgaXMgbm90IGRlZmluZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm9uRXZlbnQoZXZlbnQuZGV0YWlsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLiNkcml2ZXIuaW5pdCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogQHR5cGUge01lc3NhZ2VQb3J0W119XHJcbiAqL1xyXG5jb25zdCBwb3J0cyA9IFtdO1xyXG5cclxuLyoqXHJcbiAqIEB0eXBlIHtTZXJ2ZXJTZW50RXZlbnRzfG51bGx9XHJcbiAqL1xyXG5sZXQgZXZlbnRzID0gbnVsbDtcclxuXHJcbnNlbGYub25jb25uZWN0ID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBwb3J0ID0gZXZlbnQucG9ydHNbMF07XHJcblxyXG4gICAgcG9ydHMucHVzaChwb3J0KTtcclxuXHJcbiAgICBpZiAoZXZlbnRzID09PSBudWxsKSB7XHJcbiAgICAgICAgZXZlbnRzID0gbmV3IFNlcnZlclNlbnRFdmVudHMoKTtcclxuICAgICAgICBldmVudHMub25FdmVudCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLm1vZGUgIT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NoYXJlZCB3b3JrZXIgcG9zdE1lc3NhZ2UnLCBldmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2xpZW50IG9mIHBvcnRzKSB7XHJcbiAgICAgICAgICAgICAgICBjbGllbnQucG9zdE1lc3NhZ2UoZXZlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHBvcnQub25tZXNzYWdlID0gKGUpID0+IHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gZS5kYXRhO1xyXG5cclxuICAgICAgICBpZiAobWVzc2FnZS5jb25maWcgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnRzLmRyaXZlclR5cGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50cy5kcml2ZXJUeXBlID0gbWVzc2FnZS5jb25maWcuZHJpdmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGV2ZW50cy5tb2RlID0gbWVzc2FnZS5jb25maWcubW9kZTtcclxuICAgICAgICAgICAgZXZlbnRzLmJhc2VVcmwgPSBtZXNzYWdlLmNvbmZpZy5iYXNlVXJsO1xyXG4gICAgICAgICAgICBldmVudHMuaW5pdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGV2ZW50cy5tb2RlICE9PSAncHJvZHVjdGlvbicpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NoYXJlZCB3b3JrZXIgbWVzc2FnZScsIG1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQmFzZVNlcnZlckV2ZW50c0RyaXZlciIsIkV2ZW50VGFyZ2V0IiwibW9kZSIsImV2ZW50c1VybCIsImNvbnN0cnVjdG9yIiwic3VwZXIiLCJ0aGlzIiwiaW5pdCIsIm9uRXZlbnRUcmlnZ2VyZWQiLCJldmVudERhdGEiLCJjb25zb2xlIiwibG9nIiwiZXZlbnQiLCJDdXN0b21FdmVudCIsImRldGFpbCIsImRpc3BhdGNoRXZlbnQiLCJTZXJ2ZXJFdmVudHNTU0VEcml2ZXIiLCJ1cmwiLCJEYXRlIiwibm93IiwiRXZlbnRTb3VyY2UiLCJvbm9wZW4iLCJvbm1lc3NhZ2UiLCJKU09OIiwicGFyc2UiLCJkYXRhIiwidW5kZWZpbmVkIiwiZXZlbnRJZCIsImxhc3RFdmVudElkIiwib25lcnJvciIsIlNlcnZlckV2ZW50c0FqYXhEcml2ZXIiLCJzZXRUaW1lb3V0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm9rIiwiRXJyb3IiLCJzdGF0dXMiLCJyZXN1bHQiLCJqc29uIiwiZXZlbnRzIiwiZm9yRWFjaCIsImlkIiwiZXJyb3IiLCJtZXNzYWdlIiwiU2VydmVyRXZlbnRzRHJpdmVyRmFjdG9yeSIsImJhc2VVcmwiLCJnZXRCeVR5cGUiLCJkcml2ZXJUeXBlIiwiZHJpdmVyIiwic2VydmVyU2VudEV2ZW50c1VybCIsImFqYXhFdmVudHNVcmwiLCJTZXJ2ZXJTZW50RXZlbnRzIiwib25FdmVudCIsImZhY3RvcnkiLCJhZGRFdmVudExpc3RlbmVyIiwibmFtZSIsInBvcnRzIiwic2VsZiIsIm9uY29ubmVjdCIsInBvcnQiLCJwdXNoIiwiY2xpZW50IiwicG9zdE1lc3NhZ2UiLCJlIiwiY29uZmlnIl0sInNvdXJjZVJvb3QiOiIifQ==